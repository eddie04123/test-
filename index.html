function doPost(e) {
  try {
    const folderName = "Luxury Uploads"; // This folder will be auto-created if it doesnâ€™t exist
    const folder = getOrCreateFolder(folderName);

    const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    const timeStamp = new Date();

    const name = e.parameter.name;
    const email = e.parameter.email;
    const phone = e.parameter.phone;
    const focus = e.parameter.focus;

    let fileUrl = "No file uploaded";

    // Handle file upload
    if (e.files && e.files.file) {
      const blob = e.files.file;
      const uploadedFile = folder.createFile(blob);
      uploadedFile.setName(`${name}_POF_${timeStamp.toISOString()}`);
      fileUrl = uploadedFile.getUrl();
    }

    // Save to sheet
    sheet.appendRow([timeStamp, name, email, phone, focus, fileUrl]);

    return ContentService.createTextOutput("Success")
                         .setMimeType(ContentService.MimeType.TEXT);

  } catch (error) {
    return ContentService.createTextOutput("Error: " + error.message);
  }
}

function getOrCreateFolder(folderName) {
  const folders = DriveApp.getFoldersByName(folderName);
  return folders.hasNext() ? folders.next() : DriveApp.createFolder(folderName);
}
